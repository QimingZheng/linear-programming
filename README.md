# Linear Programming Solver 线性规划求解器

## 单纯形法算法

### 标准型

单纯形法基于标准形的线性规划问题，假设有n个变量和m个约束。线性规划的标准形式如下：
$\begin{align}
  & & \max \sum\limits_{1\le k\le n}{{{c}_{k}}{{x}_{k}}} \\ 
 & s.t. & \sum\limits_{1\le k\le n}{{{A}_{1,k}}{{x}_{k}}}\le {{b}_{1}}, \\ 
 & & \sum\limits_{1\le k\le n}{{{A}_{2,k}}{{x}_{k}}\le {{b}_{2}},} \\ 
 & ... \\ 
 & & \sum\limits_{1\le k\le n}{{{A}_{m,k}}{{x}_{k}}}\le {{b}_{m}} \\ 
 & & {{x}_{1}},{{x}_{2,}}...,{{x}_{n}}\ge 0  
\end{align}$

所有其他形式的线性规划方程组都可以按照下列方式转化成标准形式：
- 目标函数并非最大化：将所有$c_k$取负。
- 约束条件中存在大于或等于约束：将约束两边取负。
- 约束条件中存在等式：将其拆分为两个不等式（一个大于等于，一个小于等于）
- 有的变量没有非负约束：加入新变量$x'$, $x''$($x'$,$x''$>=0)并用$x'-x''替换原来的变量$x$

### 松弛化

可以将标准形式的线性规划转化为松弛形式，以方便运算。
在原来n个变量，m个约束的线性规划中，加入m个新的变量，将原来的不等式化为等式：

${{x}_{n+j}}={{b}_{j}}-\sum\limits_{1\le k\le n}{{{A}_{j,k}}{{x}_{k}}}$

当然，此时${{x}_{n+j}}\ge 0$依然成立。

我们将${{x}_{1}},{{x}_{2}},...,{{x}_{n}}$这些变量称为*非基变量*，它们构成的[[集合 (數學)|集合]]记为N。将
${{x}_{n+1}},{{x}_{n+2}},...,{{x}_{n+m}}$这些变量称为*基变量*，它们构成的集合记为B。非基变量能够由基变量唯一确定。

在这样的定义下，线性规划的松弛形式可以写为如下形式：

$\begin{align}
  & \max \sum\limits_{k\in N}{{{c}_{k}}{{x}_{k}}} \\ 
 & s.t. \\ 
 & \forall 1\le i\le n+m,{{x}_{i}}\ge 0 \\ 
 & \forall j\in B,{{x}_{j}}={{b}_{j}}-\sum\limits_{k\in N}{{{A}_{j,k}}{{x}_{k}}} \\ 
\end{align}$

因此，线性规划的松弛形式可以由$c, A, b, N, B$唯一确定，$c$是长度为n的向量，$b$是长度为m的向量，$A$是m*(n+m)的矩阵。$N, B$是整数集合，分别表示非基变量集合以及基变量集合:

$\max \vec c^T \vec x $

s.t. $[A_N, \vec 1][\begin{matrix}
x_{N} \\
x_{B}
\end{matrix}] = b$

## 转轴操作

*转轴操作*是单纯形法中的核心操作，其作用是将一个基变量与一个非基变量进行互换。可以将转轴操作理解为从单纯形上的一个顶点走向另一个顶点。

设变量${{x}_{n+d}}$属于B（基变量），变量${{x}_{e}}$属于N（非基变量），执行转轴操作pivot(d,e)之后，${{x}_{n+d}}$将变为非基变量，相应地${{x}_{e}}$将变为基变量。

具体地说，一开始我们有

${{x}_{n+d}}={{b}_{d}}-\sum\limits_{k\in N}{{{A}_{d,k}}{{x}_{k}}}$

移项，得

$A_{d,e}x_e = b_d-\sum\limits_{k\in N,k\ne e}A_{d,k}x_k-{x}_{n+d}$

如果${{A}_{d,e}}\ne 0$，我们有

${{x}_{e}}=\frac{{{b}_{d}}}{{{A}_{d,e}}}-(\sum\limits_{k\in N,k\ne e}{\frac{{{A}_{d,k}}}{{{A}_{d,e}}}{{x}_{k}})}-\frac{1}{{{A}_{d,e}}}{{x}_{n+d}}$

将此式替代转换前的原式，并代入其他的约束等式以及目标函数，我们就实现了${{x}_{n+d}}$与${{x}_{e}}$在基变量和非基变量上的互换。


## 最优化过程

如果b向量所有元素非负，则显然我们只需要令所有的变量等于0，就可以得到一个可行解。在这种情况下，通过下述最优化过程，我们可以得到该线性规划的最优解，或者指出该线性规划的最优解为无穷大（不存在）。
1. 任取一个非基变量${{x}_{e}}$，使得${{c}_{e}}>0$。
2. 选取一个基变量${{x}_{d}}$，使得${{A}_{d,e}}>0$，且最小化${{{b}_{d}}}/{{{A}_{d,e}}}\;$
3. 执行转轴操作pivot(d, e)，并转到第一步继续算法。

根据${{{b}_{d}}}/{{{A}_{d,e}}}\;$的最小性不难证明pivot(d, e)不会破坏b的非负性。因此将所有变量取0值仍然是可行解。同时，根据$\Delta v={{c}_{e}}\frac{{{b}_{d}}}{{{A}_{d,e}}}\ge 0$，我们发现v一定是不降的。这就达到了更新解的目的。

不难发现，算法终止有两种情况：
1. 对于所有的非基变量，c均非正。
2. 对于某一个e，所有的${{A}_{d,e}}$均非正。
可以证明，对于第一种情况，我们已经得到了该线性规划的最优解。当前的v即为答案。严格证明比较复杂，但是直观上是很容易理解的。因为所有的非基变量都是非负的，而所有的c都是非正的，因此只要某个非基变量不为0，就会使得目标函数更小。

对于第二种情况来说，很容易证明此时线性规划的最优解是无穷大。只要让其他所有变量均为0，变量${{x}_{e}}$为正无穷。由于所有的${{A}_{d,e}}$都非正，因此非基变量的非负性得到保证。同时由于${{c}_{e}}>0$，目标函数值为正无穷。

## 初始化

如果b向量并不全为非负，则我们需要通过初始化过程来找到一个可行解，然后才可以使用最优化过程进行优化。当然，此时原线性规划不一定存在可行解。

具体的方法是，加入一个新的非基变量${{x}_{0}}$，并在原线性规划的基础上构造一个新的辅助的线性规划。

$\begin{align}
  & \max -{{x}_{0}} \\ 
 & s.t. \\ 
 & \forall 0\le i\le n+m,{{x}_{i}}\ge 0 \\ 
 & \forall j\in B,{{x}_{j}}={{b}_{j}}-(\sum\limits_{k\in N}{{{A}_{j,k}}{{x}_{k}}})+{{x}_{0}} \\ 
\end{align}$

注意这里N集合并不包含${{x}_{0}}$。

然后，选择一个基变量${{x}_{d}}$使得${{b}_{d}}$最小，执行转轴操作pivot(d, 0)。不难证明该操作过后所有的b值全部非负。然后，使用前文中所述的最优化过程求解该辅助线性规划。

由于${{x}_{0}}$非负，因此该线性规划的答案非正。如果答案为负数，则说明原线性规划不可能让所有的基变量都非负，因此原线性规划无可行解。否则，只要令所有变量为0，并去掉${{x}_{0}}$变量，就可以得到可行解。

在从辅助线性规划转化到原来的线性规划的过程中，如果${{x}_{0}}$已经是非基变量，则可以将其从约束条件和目标函数中直接去掉。否则，需要任取一个非基变量${{x}_{e}}$执行pivot(0, e)，将${{x}_{0}}$变为非基变量。由于此时${{x}_{0}}$是基变量且${{x}_{0}}=0$，故${{b}_{0}}=0$一定成立，因此这个转轴操作不会破坏b向量的非负性。原问题优化目标函数中的基变量替换成对应的非基变量替换式后即可求解原问题。


## References

1. https://en.wikipedia.org/wiki/Simplex_algorithm
2. https://zh.wikipedia.org/zh-hans/%E5%8D%95%E7%BA%AF%E5%BD%A2%E6%B3%95
3. [Introduction to Algorithms, 3rd edition. Linear Programming](./doc/linear-programming.pdf)
4. https://stackoverflow.com/questions/58964951/simplex-algorithm-initialize-simplex

